pool:
  vmImage: ubuntu-latest

steps:
- task: Docker@2
  displayName: Login
  inputs:
    containerRegistry: 'DockerHub'
    command: 'login'
- script: |
    docker run --privileged --rm tonistiigi/binfmt --install all
    docker buildx create --use --bootstrap --name ado-build
    docker buildx build --push --platform linux/amd64,linux/arm64 -t qbituniverse/local-api-buildx:$(build.buildNumber) -f .cicd/docker/api/Dockerfile-ai-r-core-api-buildx .
  displayName: 'docker buildx'
